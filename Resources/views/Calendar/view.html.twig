{% extends 'OroUIBundle:actions:view.html.twig' %}

{% set format = oro_config_value('oro_locale.name_format') %}
{% set name = entity.owner.fullname(format)|default('N/A') %}
{% oro_title_set({params : {"%username%": name }}) %}

{% block head_script %}
    {{ parent() }}
{% endblock %}

{% block navButtons %}
{% endblock navButtons %}

{% block pageHeader %}
    {% set breadcrumbs = {'entity': entity, 'indexLabel': 'Calendar', 'entityTitle': name } %}
    {{ parent() }}
{% endblock pageHeader %}

{% block stats %}{% endblock stats %}

{% block content_data %}
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span3">
               <div>
                   test
               </div>
            </div>
            <div class="span9" id="calendar"></div>
        </div>
    </div>

    <script type="text/html" id="template-calendar-event">
        {% set data = [
                form_row(form.title, {'label': 'Title', 'value': '{title}'}),
                form_row(form.start, {'label': 'Start', 'value': '{start}'}),
                form_row(form.end, {'label': 'End', 'value': '{end}'}),
                form_row(form.allDay, {'label': 'All day event', 'attr': { 'checkedif': 'allDay' } }),
                form_row(form.reminder, {'label': 'Reminder', 'attr': { 'checkedif': 'reminder' } }),
            ]
        %}
        <div class="alert alert-error" style="display: none;"></div>
        <form id="{{ form.vars.name }}" action="#">
            <fieldset class="form-horizontal">
                {{ UI.scrollSubblock(null, data, true, false) }}
                <div class="widget-actions form-actions" style="display: none;">
                    <% if (id != null) { %>
                    {{
                        UI.deleteButton({
                            'aCss': 'no-hash',
                            'id': 'btn-remove-calendarevent',
                            'dataMessage': 'Are you sure you want to delete this event?',
                            'title': 'Delete event',
                            'label': 'Delete'
                        })
                    }}
                    <% } %>
                    <button class="btn" type="reset">{{ 'Cancel'|trans }}</button>
                    <button class="btn btn-primary" type="submit">{{ 'Save'|trans }}</button>
                </div>
            </fieldset>
        </form>
    </script>

    <script type="text/javascript">
        require(['jquery', 'underscore', 'oro/calendar', 'oro/calendar/collection'],
                function($, _, Calendar, CalendarEventCollection){
                    var events = new CalendarEventCollection();
                    events.reset({{ render(path('oro_api_get_calendarevents', {calendar: entity.id, start: startDate|date('c'), end: endDate|date('c'), subordinate: true})) }});
                    var options = {
                        el: '#calendar',
                        collection: events,
                        calendar: {{ entity.id }},
                        subordinate: true,
                        eventFormValidationScriptUrl: '{{ JSFV(form, true) }}'
                    };
                    _.extend(options, {{ calendar|json_encode|raw }});
                    var calendar = new Calendar(options);
                  });
    </script>
{% endblock content_data %}
